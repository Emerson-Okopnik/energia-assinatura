# roles/common/tasks/main.yml
- name: Atualizar cache APT
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Instalar pacotes base
  ansible.builtin.apt:
    name:
      - git
      - unzip
      - curl
      - htop
      - gnupg
      - software-properties-common
      - nginx
      - python3-venv
      - build-essential
      - libpq-dev
      - ufw
      - chromium-browser
      - libatk1.0-0
      - libatk-bridge2.0-0
      - libnss3
      - libx11-xcb1
      - libxcomposite1
      - libxdamage1
      - libxrandr2
      - libgbm1
      - fonts-liberation
    state: present

- name: Instalar Chromium via APT em distribuições Debian
  ansible.builtin.apt:
    name: chromium
    state: present
  when:
    - ansible_distribution == "Debian"

- name: Garantir que o Snapd esteja instalado em distribuições Ubuntu 22.04+
  ansible.builtin.apt:
    name: snapd
    state: present
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version is version('22.04', '>=')

- name: Instalar Chromium via Snap em distribuições Ubuntu 22.04+
  ansible.builtin.command:
    cmd: snap install chromium
    creates: /snap/bin/chromium
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version is version('22.04', '>=')

- name: Instalar Node.js e npm
  ansible.builtin.apt:
    name: nodejs
    state: present
    update_cache: yes

- name: Instalar Composer globalmente
  ansible.builtin.apt:
    name: composer
    state: present
